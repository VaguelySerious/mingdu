---
description: 
globs: 
alwaysApply: false
---
# MingDu Memory

## Current Progress
- Basic chat interface working with sidebar and conversation management
- Messages component with proper markdown rendering
- Conversation storage using localStorage
- Model picker integration
- Fixed sidebar highlighting and real-time updates
  - New conversations created immediately on "New Chat" click
  - Sidebar updates without page refresh
  - Proper conversation highlighting

## Core Implementation Status
- ✅ Basic NextJS + ShadCN + Tailwind setup complete
- ✅ Chat interface with AI provider integration complete
- ✅ Local storage for chat messages implemented
- ✅ Chat history persists across page reloads
- ✅ Conversation management with sidebar navigation
- ✅ Multiple conversation support with localStorage
- ✅ Conversation switching and creation (fixed infinite re-render with useCallback memoization)
- ✅ Conversation deletion from sidebar
- ✅ Message count display in conversation list
- ✅ Centralized types in lib/types.ts
- ✅ Fixed new chat flow: "New Chat" clears selection, conversation created on message submit (fixed conversationSwitched flag blocking new conversation creation)
- ⏳ Dictionary lookup system (TODO)
- ⏳ Word frequency tracking (TODO)
- ⏳ Grammar corrections (TODO)
- ⏳ Word coloring by mastery (TODO)

## Architecture
- Chat uses `@ai-sdk/react` useChat hook
- Custom `useConversationStorage` hook manages multiple conversations with memoized functions
- Conversations stored in localStorage with key `mingdu-conversations`
- Current conversation ID stored separately for state management
- Auto-save on message changes, auto-load on app start
- Sidebar navigation for conversation switching
- All functions properly memoized with useCallback to prevent infinite re-renders
- Types centralized in lib/types.ts for consistency
- New chat flow: `clearCurrentConversation()` deselects current conversation, new conversation created on first message submission

## File Structure
- `components/chat/chat.tsx` - Main chat component with conversation integration
- `lib/hooks/use-conversation-storage.tsx` - Custom hook for conversation management
- `components/layout/sidebar.tsx` - Conversation list sidebar with logo and delete buttons
- `components/layout/sidebar/counter.tsx` - Small counter component for message counts (positioned next to date)
- `components/layout/header.tsx` - Minimal header (logo moved to sidebar)
- `components/chat/messages.tsx` - Message display component
- `app/api/chat/route.ts` - Chat API endpoint
- `lib/types.ts` - Centralized type definitions (Conversation, Message)

## Data Sources
- Cedict dictionary in `public/data/cedict_ts.u8` + `cedict.idx`
- Grammar keywords in `public/data/grammarKeywords.txt`
- HSK lists in `public/data/hskLists.txt`



